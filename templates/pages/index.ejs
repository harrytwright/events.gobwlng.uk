<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tournament Results - GoBowling Events</title>
    <meta name="description" content="Browse bowling tournament results from GoBowling Events">
    <link rel="icon" href="/assets/favicon.ico" sizes="any">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="icon" type="image/png" sizes="96x96" href="/assets/favicon-96x96.png">
    <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
    <link rel="mask-icon" href="/assets/logo-2-masked.svg" color="#1d4ed8">
    <link rel="manifest" href="/assets/site.webmanifest">
    <meta name="theme-color" content="#efefef">
    <meta property="og:title" content="Tournament Results - GoBowling Events">
    <meta property="og:description" content="Browse bowling tournament results from GoBowling Events">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="GoBowling Tournaments">
    <% if (pageUrl) { %>
      <meta property="og:url" content="<%= pageUrl %>">
      <link rel="canonical" href="<%= pageUrl %>">
    <% } %>
    <% if (ogImageUrl) { %>
      <meta property="og:image" content="<%= ogImageUrl %>">
      <meta property="og:image:width" content="1200">
      <meta property="og:image:height" content="630">
      <meta name="twitter:image" content="<%= ogImageUrl %>">
    <% } %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Tournament Results - GoBowling Events">
    <meta name="twitter:description" content="Browse bowling tournament results from GoBowling Events">
    <link rel="stylesheet" href="/style/index.css" />
    <%- await include('../partials/posthog') %>
    <style>
      /* Smooth transitions */
      .event-card {
        transition: all 150ms ease-in-out;
      }
    </style>
  </head>
  <body class="bg-pin">
    <%- await include('../partials/site-header', { title: 'GoBowling Shipley Lanes' }) %>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 md:py-12">
      <!-- Page Header -->
      <header class="mb-10 text-center">
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-3">
          Tournament Results
        </h1>
        <p class="text-lg text-gray-600 max-w-2xl mx-auto">
          Browse results from all GoBowling events
        </p>
      </header>

      <% if (events.length === 0) { %>
        <!-- No Events Message -->
        <div class="text-center py-16">
          <svg class="w-20 h-20 mx-auto mb-4 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
          <h2 class="text-xl font-semibold text-gray-700 mb-2">No events yet</h2>
          <p class="text-gray-500">Check back soon for tournament results.</p>
        </div>
      <% } else { %>
        <%
          const formatItems = [...new Set(events.map((event) => event.meta.format).filter(Boolean))]
            .map((value) => ({ value, label: getDisplayName(value, formatDisplayNames) }))
            .sort((a, b) => a.label.localeCompare(b.label));
          const typeItems = [...new Set(events.map((event) => event.meta.type).filter(Boolean))]
            .map((value) => ({ value, label: getDisplayName(value, typeDisplayNames) }))
            .sort((a, b) => a.label.localeCompare(b.label));
          const yearItems = [...new Set(events.map((event) => event.year).filter(Boolean))]
            .sort((a, b) => Number(b) - Number(a));
        %>

        <!-- Filters -->
        <section class="mb-8">
          <div class="flex flex-col gap-4 p-4 md:flex-row md:items-center md:justify-between md:px-6">
            <div class="flex flex-wrap items-center gap-3">
              <span class="text-sm font-semibold text-gray-600">Filter by</span>
              <div class="flex flex-wrap gap-2">
                <div class="relative">
                  <label for="filterFormat" class="sr-only">Format</label>
                  <select
                    id="filterFormat"
                    class="appearance-none rounded-md border border-gray-200 bg-white px-4 py-2 pr-9 text-sm font-semibold text-gray-700 shadow-sm focus:border-firebrick focus:outline-none focus:ring-1 focus:ring-firebrick"
                  >
                    <option value="">All formats</option>
                    <% formatItems.forEach((item) => { %>
                      <option value="<%= item.value %>"><%= item.label %></option>
                    <% }); %>
                  </select>
                  <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.22 7.22a.75.75 0 0 1 1.06 0L10 10.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 8.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                </div>

                <div class="relative">
                  <label for="filterType" class="sr-only">Type</label>
                  <select
                    id="filterType"
                    class="appearance-none rounded-md border border-gray-200 bg-white px-4 py-2 pr-9 text-sm font-semibold text-gray-700 shadow-sm focus:border-firebrick focus:outline-none focus:ring-1 focus:ring-firebrick"
                  >
                    <option value="">All types</option>
                    <% typeItems.forEach((item) => { %>
                      <option value="<%= item.value %>"><%= item.label %></option>
                    <% }); %>
                  </select>
                  <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.22 7.22a.75.75 0 0 1 1.06 0L10 10.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 8.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                </div>

                <div class="relative">
                  <label for="filterYear" class="sr-only">Year</label>
                  <select
                    id="filterYear"
                    class="appearance-none rounded-md border border-gray-200 bg-white px-4 py-2 pr-9 text-sm font-semibold text-gray-700 shadow-sm focus:border-firebrick focus:outline-none focus:ring-1 focus:ring-firebrick"
                  >
                    <option value="">All years</option>
                    <% yearItems.forEach((year) => { %>
                      <option value="<%= year %>"><%= year %></option>
                    <% }); %>
                  </select>
                  <svg class="pointer-events-none absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.22 7.22a.75.75 0 0 1 1.06 0L10 10.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 8.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                  </svg>
                </div>
              </div>
            </div>

            <div class="flex items-center gap-3 text-sm text-gray-500">
              <span id="filterCount"></span>
              <button
                id="clearFilters"
                type="button"
                class="hidden text-sm font-semibold text-firebrick hover:text-firebrick-700"
              >
                Clear filters
              </button>
            </div>
          </div>

          <div id="activeFilters" class="mt-3 hidden flex flex-wrap gap-2"></div>
        </section>

        <!-- Events Grid -->
        <div id="eventGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          <% events.forEach((event) => { %>
            <a
              href="/events/<%= event.slug %>/<%= event.year %>/"
              class="event-card block bg-white shadow-md border border-gray-200 border-l-2 border-l-gray-300 rounded-md p-6 hover:shadow-lg hover:border-gray-300"
              data-event-card
              data-format="<%= event.meta.format || '' %>"
              data-type="<%= event.meta.type || '' %>"
              data-year="<%= event.year || '' %>"
            >
              <h2 class="text-xl font-bold text-gray-900 mb-3">
                <%= event.meta.name || 'Unnamed Event' %>
              </h2>

              <% if (event.meta.description) { %>
                <p class="text-sm text-gray-600 mb-4">
                  <%= event.meta.description %>
                </p>
              <% } %>

              <div class="flex flex-wrap gap-3 mb-4">
                <% if (event.meta.format) { %>
                  <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                    </svg>
                    <span><%= getDisplayName(event.meta.format, formatDisplayNames) %></span>
                  </span>
                <% } %>

                <% if (event.meta.type) { %>
                  <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 0 0 3 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 0 0 5.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 0 0 9.568 3Z" />
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6Z" />
                    </svg>
                    <span><%= getDisplayName(event.meta.type, typeDisplayNames) %></span>
                  </span>
                <% } %>

                <% if (event.meta.category) { %>
                  <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15 9h3.75M15 12h3.75M15 15h3.75M4.5 19.5h15a2.25 2.25 0 0 0 2.25-2.25V6.75A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25v10.5A2.25 2.25 0 0 0 4.5 19.5Zm6-10.125a1.875 1.875 0 1 1-3.75 0 1.875 1.875 0 0 1 3.75 0Zm1.294 6.336a6.721 6.721 0 0 1-3.17.789 6.721 6.721 0 0 1-3.168-.789 3.376 3.376 0 0 1 6.338 0Z" />
                    </svg>
                    <span><%= getDisplayName(event.meta.category, categoryDisplayNames) %></span>
                  </span>
                <% } %>

                <% if (event.meta.pattern) { %>
                  <span class="inline-flex items-center gap-1.5 text-sm font-semibold text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M4.098 19.902a3.75 3.75 0 0 0 5.304 0l6.401-6.402M6.75 21A3.75 3.75 0 0 1 3 17.25V4.125C3 3.504 3.504 3 4.125 3h5.25c.621 0 1.125.504 1.125 1.125v4.072M6.75 21a3.75 3.75 0 0 0 3.75-3.75V8.197M6.75 21h13.125c.621 0 1.125-.504 1.125-1.125v-5.25c0-.621-.504-1.125-1.125-1.125h-4.072M10.5 8.197l2.88-2.88c.438-.439 1.15-.439 1.59 0l3.712 3.713c.44.44.44 1.152 0 1.59l-2.879 2.88M6.75 17.25h.008v.008H6.75v-.008Z" />
                    </svg>
                    <span><%= event.meta.pattern %></span>
                  </span>
                <% } %>

                <% if (event.meta.dates && event.meta.dates.length) { %>
                  <div class="inline-flex items-center gap-1.5 text-sm font-semibold text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5m-9-6h.008v.008H12v-.008ZM12 15h.008v.008H12V15Zm0 2.25h.008v.008H12v-.008ZM9.75 15h.008v.008H9.75V15Zm0 2.25h.008v.008H9.75v-.008ZM7.5 15h.008v.008H7.5V15Zm0 2.25h.008v.008H7.5v-.008Zm6.75-4.5h.008v.008h-.008v-.008Zm0 2.25h.008v.008h-.008V15Zm0 2.25h.008v.008h-.008v-.008Zm2.25-4.5h.008v.008H16.5v-.008Zm0 2.25h.008v.008H16.5V15Z" />
                    </svg>
                    <span><%= formatDateRange(event.meta.dates) %></span>
                  </div>
                <% } %>
              </div>

              <% if (event.lockfile?.lastChangeAt || event.lockfile?.generatedAt) { %>
                <p class="text-xs text-gray-500">
                  Updated <%= formatLastUpdated(event.lockfile?.lastChangeAt || event.lockfile?.generatedAt) %>
                </p>
              <% } %>

              <div class="mt-4 flex items-center text-firebrick text-sm font-medium hover:text-firebrick-700 transition-colors">
                <span>View Results</span>
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-4 h-4 ml-1">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 4.5 21 12m0 0-7.5 7.5M21 12H3" />
                </svg>
              </div>
            </a>
          <% }); %>
        </div>

        <div id="noResults" class="hidden text-center py-16">
          <h2 class="text-xl font-semibold text-gray-700 mb-2">No matching events</h2>
          <p class="text-gray-500">Try adjusting or clearing your filters.</p>
        </div>
      <% } %>

      <!-- Footer -->
      <%- await include('../partials/footer') %>
    </main>

    <% if (events.length > 0) { %>
      <script>
        (() => {
          const formatSelect = document.getElementById("filterFormat");
          const typeSelect = document.getElementById("filterType");
          const yearSelect = document.getElementById("filterYear");
          const clearButton = document.getElementById("clearFilters");
          const activeFilters = document.getElementById("activeFilters");
          const cards = Array.from(document.querySelectorAll("[data-event-card]"));
          const count = document.getElementById("filterCount");
          const emptyState = document.getElementById("noResults");

          const filterFields = [
            { key: "format", label: "Format", select: formatSelect },
            { key: "type", label: "Type", select: typeSelect },
            { key: "year", label: "Year", select: yearSelect },
          ];

          const update = () => {
            const format = formatSelect.value;
            const type = typeSelect.value;
            const year = yearSelect.value;
            let visible = 0;

            cards.forEach((card) => {
              const match =
                (!format || card.dataset.format === format) &&
                (!type || card.dataset.type === type) &&
                (!year || card.dataset.year === year);
              card.hidden = !match;
              if (match) visible += 1;
            });

            if (count) {
              count.textContent = `Showing ${visible} of ${cards.length} events`;
            }
            if (emptyState) {
              emptyState.classList.toggle("hidden", visible !== 0);
            }

            if (activeFilters) {
              activeFilters.innerHTML = "";
              const active = filterFields.filter((field) => field.select.value);
              active.forEach((field) => {
                const chip = document.createElement("button");
                chip.type = "button";
                chip.className =
                  "group inline-flex items-center gap-2 rounded-md bg-gray-100 px-3 py-1 text-xs font-semibold text-gray-700 hover:bg-gray-200";
                chip.dataset.filter = field.key;

                const label = document.createElement("span");
                label.textContent = `${field.label}: ${field.select.selectedOptions[0].textContent}`;

                const icon = document.createElement("span");
                icon.className = "text-gray-400 group-hover:text-gray-600";
                icon.textContent = "x";

                chip.appendChild(label);
                chip.appendChild(icon);
                chip.addEventListener("click", () => {
                  field.select.value = "";
                  update();
                });

                activeFilters.appendChild(chip);
              });

              activeFilters.classList.toggle("hidden", active.length === 0);
              if (clearButton) {
                clearButton.classList.toggle("hidden", active.length === 0);
              }
            }
          };

          [formatSelect, typeSelect, yearSelect].forEach((select) => {
            select.addEventListener("change", update);
          });

          if (clearButton) {
            clearButton.addEventListener("click", () => {
              formatSelect.value = "";
              typeSelect.value = "";
              yearSelect.value = "";
              update();
            });
          }

          update();
        })();
      </script>
    <% } %>
  </body>
</html>
